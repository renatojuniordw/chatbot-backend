'use strict';
function _0x596f(_0x4ad503, _0x3cecc5) {
    const _0x404484 = _0x40f6();
    return _0x596f = function (_0x175f35, _0x1aba40) {
        _0x175f35 = _0x175f35 - (0x1b6d * -0x1 + -0x216d + -0x2 * -0x1efc);
        let _0x56f64c = _0x404484[_0x175f35];
        return _0x56f64c;
    }, _0x596f(_0x4ad503, _0x3cecc5);
}
const _0x4ad93a = _0x596f;
(function (_0x60cb21, _0x581cd9) {
    const _0x56099a = _0x596f, _0x48aed4 = _0x60cb21();
    while (!![]) {
        try {
            const _0x212544 = -parseInt(_0x56099a(0x12f)) / (-0x1 * -0x1002 + 0x121 * -0xe + -0x33) + -parseInt(_0x56099a(0x133)) / (-0x191a + -0x9e1 + 0x22fd) * (-parseInt(_0x56099a(0x179)) / (0xe60 + 0x1209 + 0x16 * -0x179)) + parseInt(_0x56099a(0x13f)) / (0x25 * 0x52 + -0x5d0 + -0x202 * 0x3) + parseInt(_0x56099a(0x188)) / (-0x20d4 + -0x4 * 0x58f + 0x3715) + parseInt(_0x56099a(0x170)) / (-0x24f3 + 0x24fd + -0x1 * 0x4) + -parseInt(_0x56099a(0x142)) / (0x1e2e + 0xd68 + -0x2b8f) * (parseInt(_0x56099a(0x140)) / (-0x15df + -0xdb0 * -0x1 + 0x837 * 0x1)) + -parseInt(_0x56099a(0x149)) / (-0x1ee3 + 0x4 * -0x7c8 + 0x1a2 * 0x26) * (parseInt(_0x56099a(0x158)) / (0x115c * 0x1 + 0x1 * -0xb17 + -0x5 * 0x13f));
            if (_0x212544 === _0x581cd9)
                break;
            else
                _0x48aed4['push'](_0x48aed4['shift']());
        } catch (_0x28ac4e) {
            _0x48aed4['push'](_0x48aed4['shift']());
        }
    }
}(_0x40f6, 0x21120 + 0x35 * -0x28c5 + 0xde45a));
function _0x40f6() {
    const _0x2e654d = [
        'value',
        'include',
        'lastMessag',
        'defineProp',
        'message',
        'O\x20número\x20é',
        'ateTicketS',
        'rvices/Upd',
        'profilePic',
        '../models/',
        'removeOnCo',
        'app',
        '4920762RmnseR',
        'ticketId',
        'stMessages',
        'e\x20novament',
        's/WbotServ',
        'lizar\x20a\x20op',
        'eateOrUpda',
        'nviada',
        'getIO',
        '1375473nRhSly',
        'KaLWu',
        '\x20obrigatór',
        'rvices/Sho',
        's/ContactS',
        'mplete',
        'originalna',
        'closed',
        'CFstG',
        '/Mustache',
        '../helpers',
        'replace',
        'ervice',
        '../libs/so',
        'ices/Check',
        '2141580LGWzOm',
        's/MessageS',
        'MessagesAs',
        '__esModule',
        'oCaVK',
        'forEach',
        'remove',
        'update',
        'emit',
        'ticket',
        'store',
        'Whatsapp',
        'map',
        'ices/Delet',
        'LkoPx',
        'icketServi',
        'SpvqE',
        's/TicketSe',
        'body',
        'AppError',
        'Number',
        'findByPk',
        'Não\x20foi\x20po',
        'hatsAppMes',
        '/SetTicket',
        'pageNumber',
        'rvices/Fin',
        'closeTicke',
        'params',
        'length',
        'path',
        'eração',
        'qIQzh',
        'add',
        'eWhatsAppM',
        'hatsAppMed',
        'VDZCb',
        'attempts',
        'messageQue',
        'User',
        'dOrCreateT',
        'mensagem',
        'companyId',
        'Read',
        'erty',
        'quotedMsg',
        'all',
        's\x20instante',
        'queues',
        'get',
        'XBMTw',
        'vice',
        'ices/SendW',
        'admin',
        'number',
        'agem,\x20tent',
        'ices/GetPr',
        'DIXam',
        'Queue',
        '401185cVRKuX',
        'isGroup',
        'toString',
        'jid',
        '2WVpLdI',
        'e\x20em\x20algun',
        'json',
        'hasMore',
        'isArray',
        'MZvlc',
        'ssível\x20env',
        '../errors/',
        'name',
        'keys',
        'messages',
        'files',
        '1774212YOzzPD',
        '5624VZONYG',
        'ofilePicUr',
        '406RRDOXZ',
        'ervices/Cr',
        'count',
        'default',
        'fPRYi',
        '-appMessag',
        'Mensagem\x20e',
        '10942263sFZyfZ',
        'push',
        'model',
        'company-',
        'query',
        'essage',
        'Service',
        'status',
        'fault',
        'index',
        'ADDiH',
        '__importDe',
        'wTicketSer',
        'ssível\x20rea',
        'iar\x20a\x20mens',
        '10VhIMLm',
        '../service',
        'cket',
        'QKwFK',
        'teContactS',
        'ticketData',
        'sage',
        'user',
        'SendMessag',
        'ervices/Li',
        'send',
        'Url'
    ];
    _0x40f6 = function () {
        return _0x2e654d;
    };
    return _0x40f6();
}
var __importDefault = this && this[_0x4ad93a(0x154) + _0x4ad93a(0x151)] || function (_0x3abb7e) {
    const _0x23ad5f = _0x4ad93a;
    return _0x3abb7e && _0x3abb7e[_0x23ad5f(0x18b)] ? _0x3abb7e : { 'default': _0x3abb7e };
};
const _0x19529e = {};
_0x19529e[_0x4ad93a(0x164)] = !![], Object[_0x4ad93a(0x167) + _0x4ad93a(0x120)](exports, _0x4ad93a(0x18b), _0x19529e), exports[_0x4ad93a(0x162)] = exports[_0x4ad93a(0x18e)] = exports[_0x4ad93a(0x192)] = exports[_0x4ad93a(0x152)] = void (0x3e5 * -0x2 + 0x5ba + 0x210);
const AppError_1 = __importDefault(require(_0x4ad93a(0x13a) + _0x4ad93a(0x19b))), SetTicketMessagesAsRead_1 = __importDefault(require(_0x4ad93a(0x183) + _0x4ad93a(0x1a0) + _0x4ad93a(0x18a) + _0x4ad93a(0x11f))), socket_1 = require(_0x4ad93a(0x186) + _0x4ad93a(0x15a)), Queue_1 = __importDefault(require(_0x4ad93a(0x16d) + _0x4ad93a(0x12e))), User_1 = __importDefault(require(_0x4ad93a(0x16d) + _0x4ad93a(0x1af))), Whatsapp_1 = __importDefault(require(_0x4ad93a(0x16d) + _0x4ad93a(0x193))), Mustache_1 = __importDefault(require(_0x4ad93a(0x183) + _0x4ad93a(0x182))), ListMessagesService_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x189) + _0x4ad93a(0x161) + _0x4ad93a(0x172) + _0x4ad93a(0x14f))), ShowTicketService_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x199) + _0x4ad93a(0x17c) + _0x4ad93a(0x155) + _0x4ad93a(0x127))), FindOrCreateTicketService_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x199) + _0x4ad93a(0x1a2) + _0x4ad93a(0x1b0) + _0x4ad93a(0x197) + 'ce')), UpdateTicketService_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x199) + _0x4ad93a(0x16b) + _0x4ad93a(0x16a) + _0x4ad93a(0x185))), DeleteWhatsAppMessage_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x174) + _0x4ad93a(0x195) + _0x4ad93a(0x1aa) + _0x4ad93a(0x14e))), SendWhatsAppMedia_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x174) + _0x4ad93a(0x128) + _0x4ad93a(0x1ab) + 'ia')), SendWhatsAppMessage_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x174) + _0x4ad93a(0x128) + _0x4ad93a(0x19f) + _0x4ad93a(0x15e))), CheckNumber_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x174) + _0x4ad93a(0x187) + _0x4ad93a(0x19c))), GetProfilePicUrl_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x174) + _0x4ad93a(0x12c) + _0x4ad93a(0x141) + 'l')), CreateOrUpdateContactService_1 = __importDefault(require(_0x4ad93a(0x159) + _0x4ad93a(0x17d) + _0x4ad93a(0x143) + _0x4ad93a(0x176) + _0x4ad93a(0x15c) + _0x4ad93a(0x185))), index = async (_0x5e45a3, _0x2ebba4) => {
        const _0x13d4b0 = _0x4ad93a, _0x46d47a = {};
        _0x46d47a[_0x13d4b0(0x12d)] = function (_0x59d9c4, _0x12fed6) {
            return _0x59d9c4 !== _0x12fed6;
        }, _0x46d47a[_0x13d4b0(0x1ac)] = _0x13d4b0(0x129), _0x46d47a[_0x13d4b0(0x146)] = _0x13d4b0(0x124);
        const _0x55eab9 = _0x46d47a, {ticketId: _0x53dc3b} = _0x5e45a3[_0x13d4b0(0x1a4)], {pageNumber: _0x15408d} = _0x5e45a3[_0x13d4b0(0x14d)], {
                companyId: _0x10f313,
                profile: _0x5d1008
            } = _0x5e45a3[_0x13d4b0(0x15f)], _0xf6a773 = [];
        if (_0x55eab9[_0x13d4b0(0x12d)](_0x5d1008, _0x55eab9[_0x13d4b0(0x1ac)])) {
            const _0x5313c2 = {};
            _0x5313c2[_0x13d4b0(0x14b)] = Queue_1[_0x13d4b0(0x145)], _0x5313c2['as'] = _0x55eab9[_0x13d4b0(0x146)];
            const _0x4c1e38 = {};
            _0x4c1e38[_0x13d4b0(0x165)] = [_0x5313c2];
            const _0x2d3db7 = await User_1[_0x13d4b0(0x145)][_0x13d4b0(0x19d)](_0x5e45a3[_0x13d4b0(0x15f)]['id'], _0x4c1e38);
            _0x2d3db7[_0x13d4b0(0x124)][_0x13d4b0(0x18d)](_0x3aa084 => {
                const _0x5a4a2f = _0x13d4b0;
                _0xf6a773[_0x5a4a2f(0x14a)](_0x3aa084['id']);
            });
        }
        const _0xda85b7 = {};
        _0xda85b7[_0x13d4b0(0x1a1)] = _0x15408d, _0xda85b7[_0x13d4b0(0x171)] = _0x53dc3b, _0xda85b7[_0x13d4b0(0x11e)] = _0x10f313, _0xda85b7[_0x13d4b0(0x124)] = _0xf6a773;
        const {
            count: _0x321d0d,
            messages: _0x3f4c9a,
            ticket: _0xf3f867,
            hasMore: _0xf2add7
        } = await (-0x3ba * -0x1 + -0x21c + 0x12 * -0x17, ListMessagesService_1[_0x13d4b0(0x145)])(_0xda85b7);
        (0xb * 0x92 + 0x2 * -0x100d + 0x19d4, SetTicketMessagesAsRead_1[_0x13d4b0(0x145)])(_0xf3f867);
        const _0x35009e = {};
        return _0x35009e[_0x13d4b0(0x144)] = _0x321d0d, _0x35009e[_0x13d4b0(0x13d)] = _0x3f4c9a, _0x35009e[_0x13d4b0(0x191)] = _0xf3f867, _0x35009e[_0x13d4b0(0x136)] = _0xf2add7, _0x2ebba4[_0x13d4b0(0x135)](_0x35009e);
    };
exports[_0x4ad93a(0x152)] = index;
const store = async (_0xedd3c3, _0x53c4ad) => {
    const _0xb62f6d = _0x4ad93a, {ticketId: _0x597582} = _0xedd3c3[_0xb62f6d(0x1a4)], {
            body: _0x1fc266,
            quotedMsg: _0x5e8162
        } = _0xedd3c3[_0xb62f6d(0x19a)], _0x2e1145 = _0xedd3c3[_0xb62f6d(0x13e)], {companyId: _0xf84177} = _0xedd3c3[_0xb62f6d(0x15f)], _0x2193e1 = await (-0x1 * -0xd49 + -0x4f4 * 0x1 + -0x1 * 0x855, ShowTicketService_1[_0xb62f6d(0x145)])(_0x597582, _0xf84177);
    (-0x3d * -0x75 + 0x1165 * -0x1 + -0xa7c, SetTicketMessagesAsRead_1[_0xb62f6d(0x145)])(_0x2193e1);
    if (_0x2e1145)
        await Promise[_0xb62f6d(0x122)](_0x2e1145[_0xb62f6d(0x194)](async (_0x494094, _0x347c0b) => {
            const _0x535883 = _0xb62f6d;
            await (0x1 * -0x227f + 0x1083 + 0x11fc, SendWhatsAppMedia_1[_0x535883(0x145)])({
                'media': _0x494094,
                'ticket': _0x2193e1,
                'body': Array[_0x535883(0x137)](_0x1fc266) ? _0x1fc266[_0x347c0b] : _0x1fc266
            });
        }));
    else {
        const _0x59d353 = {};
        _0x59d353[_0xb62f6d(0x19a)] = _0x1fc266, _0x59d353[_0xb62f6d(0x191)] = _0x2193e1, _0x59d353[_0xb62f6d(0x121)] = _0x5e8162;
        const _0x38376d = await (0x1 * 0x163b + 0x19ba + 0x1 * -0x2ff5, SendWhatsAppMessage_1[_0xb62f6d(0x145)])(_0x59d353);
    }
    return _0x53c4ad[_0xb62f6d(0x162)]();
};
exports[_0x4ad93a(0x192)] = store;
const remove = async (_0x244f48, _0x2b6e37) => {
    const _0x1918a3 = _0x4ad93a, _0x1de010 = {};
    _0x1de010[_0x1918a3(0x153)] = _0x1918a3(0x18f);
    const _0x2e9665 = _0x1de010, {messageId: _0x28e9ee} = _0x244f48[_0x1918a3(0x1a4)], {companyId: _0x39726a} = _0x244f48[_0x1918a3(0x15f)], _0x3edf84 = await (-0x809 + 0x4 * -0x304 + -0x93 * -0x23, DeleteWhatsAppMessage_1[_0x1918a3(0x145)])(_0x28e9ee), _0x448e31 = (-0x680 + -0x2c3 * 0x1 + 0x1 * 0x943, socket_1[_0x1918a3(0x178)])();
    return _0x448e31['to'](_0x3edf84[_0x1918a3(0x171)][_0x1918a3(0x131)]())[_0x1918a3(0x190)](_0x1918a3(0x14c) + _0x39726a + (_0x1918a3(0x147) + 'e'), {
        'action': _0x2e9665[_0x1918a3(0x153)],
        'message': _0x3edf84
    }), _0x2b6e37[_0x1918a3(0x162)]();
};
exports[_0x4ad93a(0x18e)] = remove;
const send = async (_0x5b5486, _0x361e69) => {
    const _0x290647 = _0x4ad93a, _0x141357 = {
            'oCaVK': _0x290647(0x124),
            'CFstG': _0x290647(0x160) + 'e',
            'MZvlc': _0x290647(0x180),
            'KaLWu': _0x290647(0x19e) + _0x290647(0x156) + _0x290647(0x175) + _0x290647(0x1a7),
            'XBMTw': function (_0x50be19, _0x412dab) {
                return _0x50be19 === _0x412dab;
            },
            'SpvqE': _0x290647(0x169) + _0x290647(0x17b) + 'io',
            'QKwFK': function (_0x2a4892, _0x1d035c, _0x372559) {
                return _0x2a4892(_0x1d035c, _0x372559);
            },
            'qIQzh': _0x290647(0x148) + _0x290647(0x177),
            'LkoPx': _0x290647(0x19e) + _0x290647(0x139) + _0x290647(0x157) + _0x290647(0x12b) + _0x290647(0x173) + _0x290647(0x134) + _0x290647(0x123) + 's'
        }, {whatsappId: _0x369930} = _0x5b5486[_0x290647(0x1a4)], _0x185ac2 = _0x5b5486[_0x290647(0x19a)], _0xef4717 = _0x5b5486[_0x290647(0x13e)];
    try {
        const _0x16d216 = await Whatsapp_1[_0x290647(0x145)][_0x290647(0x19d)](_0x369930);
        if (!_0x16d216)
            throw new Error(_0x141357[_0x290647(0x17a)]);
        if (_0x141357[_0x290647(0x126)](_0x185ac2[_0x290647(0x12a)], undefined))
            throw new Error(_0x141357[_0x290647(0x198)]);
        const _0x59003b = _0x185ac2[_0x290647(0x12a)], _0x4849e0 = _0x185ac2[_0x290647(0x19a)], _0x87d0b = _0x16d216[_0x290647(0x11e)], _0x767f5c = await (-0x243 + -0x2618 + -0x285b * -0x1, CheckNumber_1[_0x290647(0x145)])(_0x59003b, _0x87d0b), _0x35b848 = _0x767f5c[_0x290647(0x132)][_0x290647(0x184)](/\D/g, ''), _0xb9254e = await (-0x1f * 0xa3 + -0x23e8 + 0x37a5, GetProfilePicUrl_1[_0x290647(0x145)])(_0x35b848, _0x87d0b), _0x2747f7 = {};
        _0x2747f7[_0x290647(0x13b)] = '' + _0x35b848, _0x2747f7[_0x290647(0x12a)] = _0x35b848, _0x2747f7[_0x290647(0x16c) + _0x290647(0x163)] = _0xb9254e, _0x2747f7[_0x290647(0x130)] = ![], _0x2747f7[_0x290647(0x11e)] = _0x87d0b;
        const _0x452903 = _0x2747f7, _0x5c75d6 = await (0xa4 * 0x14 + -0x1988 + -0xcb8 * -0x1, CreateOrUpdateContactService_1[_0x290647(0x145)])(_0x452903), _0x27f06c = await (0x2151 + 0x18a * 0xd + -0x3553, FindOrCreateTicketService_1[_0x290647(0x145)])(_0x5c75d6, _0x16d216['id'], -0x1811 * 0x1 + -0x1f64 + 0x3775, _0x87d0b);
        if (_0xef4717)
            await Promise[_0x290647(0x122)](_0xef4717[_0x290647(0x194)](async _0x35ee23 => {
                const _0x147e6d = _0x290647, _0x673681 = {};
                _0x673681[_0x147e6d(0x16e) + _0x147e6d(0x17e)] = !![], _0x673681[_0x147e6d(0x1ad)] = 0x3, await _0x5b5486[_0x147e6d(0x16f)][_0x147e6d(0x125)](_0x141357[_0x147e6d(0x18c)])[_0x147e6d(0x1ae) + 'ue'][_0x147e6d(0x1a9)](_0x141357[_0x147e6d(0x181)], {
                    'whatsappId': _0x369930,
                    'data': {
                        'number': _0x35b848,
                        'body': _0x4849e0 ? (0x1 * -0x1537 + -0x7dd + 0x2 * 0xe8a, Mustache_1[_0x147e6d(0x145)])(_0x4849e0, _0x5c75d6) : _0x35ee23[_0x147e6d(0x17f) + 'me'],
                        'mediaPath': _0x35ee23[_0x147e6d(0x1a6)],
                        'fileName': _0x35ee23[_0x147e6d(0x17f) + 'me']
                    }
                }, _0x673681);
            }));
        else {
            await (0x1 * 0x2285 + -0x26 * 0x41 + -0x18df * 0x1, SendWhatsAppMessage_1[_0x290647(0x145)])({
                'body': (0x1 * -0x124c + -0x1 * -0x12fd + -0xb1, Mustache_1[_0x290647(0x145)])(_0x4849e0, _0x5c75d6),
                'ticket': _0x27f06c
            });
            const _0x1bf80f = {};
            _0x1bf80f[_0x290647(0x166) + 'e'] = _0x4849e0, await _0x27f06c[_0x290647(0x18f)](_0x1bf80f);
        }
        _0x185ac2[_0x290647(0x1a3) + 't'] && _0x141357[_0x290647(0x15b)](setTimeout, async () => {
            const _0x59f203 = _0x290647, _0x5f29c1 = {};
            _0x5f29c1[_0x59f203(0x150)] = _0x141357[_0x59f203(0x138)];
            const _0x362dc9 = {};
            _0x362dc9[_0x59f203(0x171)] = _0x27f06c['id'], _0x362dc9[_0x59f203(0x15d)] = _0x5f29c1, _0x362dc9[_0x59f203(0x11e)] = _0x87d0b, await (0x19c1 + 0x47 * 0x67 + -0x3652, UpdateTicketService_1[_0x59f203(0x145)])(_0x362dc9);
        }, 0xe3f * -0x2 + -0x448 + 0x24ae);
        (0x1e1c + -0xdcf + -0x104d, SetTicketMessagesAsRead_1[_0x290647(0x145)])(_0x27f06c);
        const _0x5ccabf = {};
        return _0x5ccabf[_0x290647(0x1b1)] = _0x141357[_0x290647(0x1a8)], _0x361e69[_0x290647(0x162)](_0x5ccabf);
    } catch (_0x278923) {
        if (_0x141357[_0x290647(0x126)](Object[_0x290647(0x13c)](_0x278923)[_0x290647(0x1a5)], -0x1d19 + 0x8b7 + 0xa31 * 0x2))
            throw new AppError_1[(_0x290647(0x145))](_0x141357[_0x290647(0x196)]);
        else
            throw new AppError_1[(_0x290647(0x145))](_0x278923[_0x290647(0x168)]);
    }
};
exports[_0x4ad93a(0x162)] = send;